# QueueHttp

## Запуск

База PostgreSQL описана в docker-compose.yml. Для запуска контейнера с базой: 
```docker-compose up -d```
Приложение написано на aiohttp v3.5.4. ORM -  peewee v3.9.3
Все нужные пакеты в requirements.txt в корне проета.
Запуск приложения осуществляется командой: 
```python3 main.py```


## Принцип работы
Вместе с приложением инициализируется воркер. Затем воркер запускает задачу в отдельном потоке. Функционал задачи состоит в постоянной проверке занятости воркера в текущий момент времени. 
В случае если не занят и есть задача в очереди, поток берет задачу из очереди, помечает ее как RUN.
Запускает процесс для выполнения таска, а воркера помечает "занятым". После выполнения таска, помечает ее как COMPLETE.
Процесс "джойнится". Все результаты записываются в базу. В случае если произойдет отключение проекта, например при keyboardinterrupt или других непредвиденных ситуациях, 
при повторном запуске приложения, все незавершенные задачи будут добавлены в очередь по дате их создания и обработаны 
воркером.

## Доступ к API
0.0.0.0:8080/create - добавляет задачу. Возвращает id задачи.

0.0.0.0:8080/task?id= - получить состояние задачи по id (JSON - как в описании ТЗ). В случае если задачи с таким id нету - 
возвращается сообщение с ошибкой. 
